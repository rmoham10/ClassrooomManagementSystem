<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Student Dashboard</title>
    <style>
        .form {
            display: none; /* Forms are hidden by default */
            margin-top: 20px;
        }

        .form.active {
            display: block; /* Only the active form is displayed */
        }
    </style>
</head>
<body
style="background-image: url('images/image5.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat;">
</body>
<body>
<button onclick="goBack()">back</button>
<button onclick="navigateHome()">Home</button>
<button onclick="logout()">Logout</button>


    <h2>Student Dashboard</h2>

        <ul>
            <li><a href="#" onclick="navigate('view-attendance')">View Attendance</a></li>
            <li><a href="#" onclick="navigate('view-grades')">View Grades</a></li>
        </ul>


<div class="main-content">
    <h1>Welcome, Student</h1>
    <div id="content-area">
        <!-- Content will be loaded here dynamically -->
    </div>
</div>

<script>
    // Redirect if not logged in
    if (!localStorage.getItem('token')) {
        window.location.href = 'index.html';
    }

    function goBack() {
        loadAnnouncements();
    }
    function navigateHome() {
        window.location.href = 'index.html';
    }
    function navigate(section) {
        let contentArea = document.getElementById('content-area');
        switch (section) {
            case 'view-attendance':
                loadAttendance();
                break;
            case 'view-grades':
                loadGrades();
                break;
            default:
                contentArea.innerHTML = '<p>Select a section from the sidebar.</p>';
        }
    }

    async function loadAnnouncements() {
        try {
            const response = await fetch('/api/announcements', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });

            if (response.ok) {
                const announcements = await response.json();
                let announcementsList = `<h1>Announcements</h1><ul>`;
                announcements.forEach(announcement => {
                    announcementsList += `<li><strong>${announcement.title}</strong>: ${announcement.message} </li>`;
                });
                announcementsList += '</ul>';
                document.getElementById('content-area').innerHTML = announcementsList;
            } else {
                alert('Failed to load announcements. Please try again.');
            }
        } catch (error) {
            console.error('Error loading announcements:', error);
        }
    }

    async function loadGrades() {
        try {
            const response = await fetch("/api/grades/student", {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${localStorage.getItem("token")}`
                }
            });

            if (response.ok) {
                const grades = await response.json();
                let gradeTable = '<table><tr><th>Course</th><th>Marks</th></tr>';
                grades.forEach(grade => {
                    gradeTable += `<tr>
                            <td>${grade.courseName}</td>
                            <td>${grade.marks}</td>
                        </tr>`;
                });
                gradeTable += '</table>';
                document.getElementById('content-area').innerHTML = gradeTable;
            } else {
                alert("Failed to load grades.");
            }
        } catch (error) {
            console.error("Error loading grades:", error);
        }
    }

    function logout() {
        // Clear the session
        localStorage.removeItem('token');
        localStorage.removeItem('user');

        // Prevent back navigation
        history.pushState(null, '', window.location.href);
        window.addEventListener('popstate', function () {
            history.pushState(null, '', window.location.href);
        });

        // Notify the user
        alert('You have been logged out.');

        // Redirect to the home page
        window.location.href = 'index.html';
    }


    window.onload = loadAnnouncements;
</script>
</body>
</html>
